<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirm Trip Detail</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* FRAME CSS */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #e0e0e0; display: flex; justify-content: center; align-items: center; min-height: 100vh; overflow: hidden; }
        .mockup-wrapper { width: 100%; height: 100vh; display: flex; justify-content: center; align-items: center; }
        .mockup-container { position: relative; width: 500px; height: 1020px; transform: scale(0.6); transform-origin: center center; background-image: url('mockup-iphone.png'); background-size: contain; background-repeat: no-repeat; background-position: center; }
        .phone-screen { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 440px; height: 956px; border-radius: 55px; overflow: hidden; box-shadow: inset 0 0 20px rgba(0,0,0,0.2); }
        .dynamic-island { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); width: 126px; height: 37px; background-color: #000; border-radius: 20px; z-index: 9999; }

        .screen-content { width: 100%; height: 100%; background-color: #fff; display: flex; flex-direction: column; position: relative; }
        
        .header { padding: 20px; padding-top: 60px; display: flex; align-items: center; background: white; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .back-btn { font-size: 1.8rem; color: black; margin-right: 20px; cursor: pointer; text-decoration: none; margin-left: 10px; }
        .page-title { font-size: 1.4rem; font-weight: 800; color: black; }

        #map-container { height: 35vh; width: 100%; position: relative; background: #eee; }
        #map { width: 100%; height: 100%; z-index: 1; }

        .details-section { flex-grow: 1; padding: 25px; background: white; display: flex; flex-direction: column; align-items: center; gap: 15px; overflow-y: auto; padding-bottom: 150px; /* Space for bottom bar */ }
        
        .info-card { 
            width: 100%; background-color: #efc1da; border-radius: 25px; padding: 20px; 
            display: flex; flex-direction: column; justify-content: center; 
        }
        .card-label { font-size: 0.9rem; font-weight: 800; color: #af094b; text-transform: uppercase; margin-bottom: 5px; }
        .card-value { font-size: 1rem; font-weight: 600; color: black; line-height: 1.3; }
        
        /* --- NEW BOTTOM PAYMENT BAR --- */
        .bottom-bar { 
            position: absolute; bottom: 80px; /* Above nav bar */
            width: 100%; padding: 20px 25px; 
            background: white; border-top: 1px solid #eee; z-index: 100;
        }
        .pay-trigger { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; cursor: pointer; margin-bottom: 15px; }
        .pay-left { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 1.1rem; }
        
        .confirm-btn { 
            width: 100%; padding: 20px; border-radius: 50px; border: none; 
            background-color: #af094b; color: white; font-size: 1.2rem; font-weight: 800; 
            cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); 
        }

        /* --- PAYMENT SHEET OVERLAY --- */
        #paymentOverlay { 
            position: absolute; bottom: -100%; left: 0; width: 100%; height: 75%; 
            background: white; z-index: 3000; transition: 0.4s ease; 
            border-top-left-radius: 30px; border-top-right-radius: 30px; 
            box-shadow: 0 -10px 40px rgba(0,0,0,0.3); padding: 25px; 
            display: flex; flex-direction: column;
        }
        #paymentOverlay.active { bottom: 0; }
        
        .drag-handle { width: 40px; height: 5px; background: #ddd; border-radius: 10px; margin: -10px auto 20px; }
        .payment-title { font-size: 1.4rem; font-weight: 800; color: #af094b; margin-bottom: 25px; text-align: center; }
        
        .wallet-card { 
            background: #af094b; color: white; border-radius: 20px; padding: 20px; margin-bottom: 25px; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 5px 15px rgba(175, 9, 75, 0.3);
        }
        .payment-option { 
            border: 2px solid #f0f0f0; border-radius: 15px; padding: 15px; margin-bottom: 15px; 
            display: flex; align-items: center; cursor: pointer; position: relative; transition: 0.2s;
        }
        .payment-option:hover { background: #fff5fa; }
        .payment-option.selected { border-color: #af094b; background: #fff5fa; }
        .payment-option i { font-size: 1.5rem; width: 40px; color: #af094b; }
        .check-icon { position: absolute; right: 20px; color: #af094b; display: none; }
        .payment-option.selected .check-icon { display: block; }
        
        .add-payment { 
            border: 2px dashed #af094b; color: #af094b; text-align: center; padding: 15px; 
            border-radius: 50px; font-weight: 700; margin-top: 10px; cursor: pointer; 
        }
        
        .close-sheet-btn {
            margin-top: auto; width: 100%; padding: 15px; background: #eee; border: none; border-radius: 50px; font-weight: bold; cursor: pointer;
        }

        /* NAV */
        .bottom-nav { position: absolute; bottom: 0; width: 100%; background: #fcebf4; display: flex; justify-content: space-around; padding: 15px 0; border-top-left-radius: 25px; border-top-right-radius: 25px; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 2000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: #888; font-size: 0.8rem; font-weight: 600; position: relative; width: 20%; }
        .nav-item i { font-size: 1.5rem; margin-bottom: 5px; }
        .nav-item.active { color: #af094b; }
        .nav-item.wallet-item { color: #af094b; margin-top: -35px; }
        .wallet-circle { background: #af094b; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; border: 5px solid white; margin-bottom: 5px; }
        .badge { position: absolute; top: -5px; right: 15px; background: #af094b; color: white; font-size: 0.7rem; padding: 3px 6px; border-radius: 10px; border: 2px solid white; }
    </style>
</head>
<body>
    <div class="mockup-wrapper">
        <div class="mockup-container">
            <div class="phone-screen">
                <div class="dynamic-island"></div>
                <div class="screen-content">
                    
                    <div class="header">
                        <a href="confirm-location.html" class="back-btn"><i class="fas fa-arrow-left"></i></a>
                        <div class="page-title">Confirm Your Trip</div>
                    </div>

                    <div id="map-container">
                        <div id="map"></div>
                    </div>

                    <div class="details-section">
                        <div class="info-card">
                            <div class="card-label">Pick Up</div>
                            <div class="card-value" id="pickup-display">Loading...</div>
                        </div>

                        <div class="info-card">
                            <div class="card-label">Drop Off</div>
                            <div class="card-value" id="dropoff-display">Loading...</div>
                        </div>
                    </div>

                    <div class="bottom-bar">
                        <div class="pay-trigger" onclick="togglePayment()">
                            <div class="pay-left" id="selectedPayDisplay">
                                <i class="fab fa-apple-pay"></i> Apple Pay
                            </div>
                            <span style="color: #af094b; font-weight: 700;">Change <i class="fas fa-chevron-up"></i></span>
                        </div>
                        <button class="confirm-btn" onclick="window.location.href='select-driver.html'">Confirm & Request Ride</button>
                    </div>

                    <div id="paymentOverlay">
                        <div class="drag-handle" onclick="togglePayment()"></div>
                        <h2 class="payment-title">Payment Methods</h2>
                        
                        <div class="wallet-card">
                            <div>
                                <p style="font-size: 0.9rem; opacity: 0.9;">SheWallet Balance</p>
                                <h2 style="font-size: 1.8rem;">RM 52.90</h2>
                            </div>
                            <button style="background: white; color: #af094b; border: none; padding: 8px 15px; border-radius: 20px; font-weight: 800; cursor: pointer;" onclick="window.location.href='shewallet.html'">Top Up</button>
                        </div>

                        <h4 style="margin-bottom: 15px; color:#333;">Saved Methods</h4>
                        
                        <div class="payment-option selected" onclick="setPayment(this, 'Apple Pay', 'fab fa-apple-pay')">
                            <i class="fab fa-apple-pay"></i>
                            <div>
                                <div style="font-weight: 800;">Apple Pay</div>
                                <div style="font-size: 0.8rem; color: #666;">Primary Payment</div>
                            </div>
                            <i class="fas fa-check-circle check-icon"></i>
                        </div>

                        <div class="payment-option" onclick="setPayment(this, 'Visa •••• 4242', 'fas fa-credit-card')">
                            <i class="fas fa-credit-card"></i>
                            <div>
                                <div style="font-weight: 800;">Visa •••• 4242</div>
                                <div style="font-size: 0.8rem; color: #666;">Expires 12/26</div>
                            </div>
                            <i class="fas fa-check-circle check-icon"></i>
                        </div>

                        <div class="payment-option" onclick="setPayment(this, 'Cash', 'fas fa-money-bill-wave')">
                            <i class="fas fa-money-bill-wave"></i>
                            <div>
                                <div style="font-weight: 800;">Cash</div>
                                <div style="font-size: 0.8rem; color: #666;">Pay in car</div>
                            </div>
                            <i class="fas fa-check-circle check-icon"></i>
                        </div>

                      <div class="add-payment" onclick="window.location.href='add-card.html'">
                      + Add New Payment Method
                    </div>
                        
                        <button class="close-sheet-btn" onclick="togglePayment()">Close</button>
                    </div>

                    <div class="bottom-nav">
                        <a href="home.html" class="nav-item"><i class="fas fa-home"></i>Home</a>
                        <a href="trip-detail.html" class="nav-item active"><i class="fas fa-map-marker-alt"></i>Trips</a>
                        <a href="shewallet.html" class="nav-item wallet-item"><div class="wallet-circle"><i class="fas fa-wallet"></i></div>SheWallet</a>
                        <a href="notifications.html" class="nav-item"><i class="fas fa-bell"></i><span class="badge">10</span>Notifications</a>
                        <a href="profile.html" class="nav-item"><i class="far fa-user-circle"></i>Profile</a>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map('map', { zoomControl: false });
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OpenStreetMap' }).addTo(map);

        window.onload = function() {
            // Retrieve Data from Previous Page
            const pickupName = localStorage.getItem('shego_pickup_name') || "100, Jalan Tun Perak";
            const pickupLat = parseFloat(localStorage.getItem('shego_pickup_lat')) || 3.1475;
            const pickupLng = parseFloat(localStorage.getItem('shego_pickup_lng')) || 101.6995;

            const dropoffName = localStorage.getItem('shego_dropoff_name') || "AGILE Residensi";
            const dropoffLat = parseFloat(localStorage.getItem('shego_dropoff_lat')) || 3.1434;
            const dropoffLng = parseFloat(localStorage.getItem('shego_dropoff_lng')) || 101.7043;
            
            // Update UI Text
            document.getElementById('pickup-display').innerText = pickupName;
            document.getElementById('dropoff-display').innerText = dropoffName;

            // Map Markers & Line
            var pickupMarker = L.marker([pickupLat, pickupLng]).addTo(map).bindPopup("Pick Up");
            var dropoffMarker = L.marker([dropoffLat, dropoffLng]).addTo(map).bindPopup("Drop Off");
            var latlngs = [[pickupLat, pickupLng], [dropoffLat, dropoffLng]];
            var polyline = L.polyline(latlngs, {color: '#af094b', weight: 4, dashArray: '10, 10'}).addTo(map);
            map.fitBounds(polyline.getBounds(), {padding: [50, 50]});
        };

        // --- PAYMENT LOGIC ---
        function togglePayment() {
            document.getElementById('paymentOverlay').classList.toggle('active');
        }

        function setPayment(element, name, iconClass) {
            document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            
            document.getElementById('selectedPayDisplay').innerHTML = `
                <i class="${iconClass}"></i> ${name}
            `;
            setTimeout(togglePayment, 300);
        }
    </script>
</body>
</html>